<!DOCTYPE html>
<html lang="en">

<th:block th:replace="~{includes/admin/head}" />

<script id="list_info_faq" type="text/x-handlebars-template">
    {{#resultData_faq}}
    <tr class="gradeA">
        <td>
            <input class="input_chk_delete_faq_each" type="checkbox" keyword="{{id}}" id="input_chk_delete_faq_each_{{id}}" onclick="listener_chk_delete(this, 'faq')" />
        </td>
        <td><font class="font_faq_order"></font></td>
        <td style="width:75px;">
            <i class="cursor_pointer fa fa-arrow-up" onclick="update_faq_sequence('{{id}}','up')"></i>
            <i class="cursor_pointer fa fa-arrow-down" onclick="update_faq_sequence('{{id}}','down')" style="float:right;"></i>
        </td>
        <td><font class="font_faq_deleted_{{deleted}} chk_faq_deleted_{{id}}">{{deleted}}</font></td>
        <td class="cursor_pointer" onclick="location.href='/faq/admin_detail/{{id}}';">{{title}}</td>
        <td>{{createdAt}} / {{modifiedAt}}
            <div class="hide">
                <input class="input_cursor_faq_id" value="{{id}}"/>
            </div>
        </td>
    </tr>
    {{/resultData_faq}}
</script>
<script type="text/javascript">
    var list_info_faq = $("#list_info_faq").html();
    var list_info_faq_template = Handlebars.compile(list_info_faq);
</script>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <th:block th:replace="~{includes/admin/sidebar}" />
    <script>
        $(".nav_faq_a").removeClass("collapsed");
        $(".nav_faq_div").addClass("show");
    </script>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <th:block th:replace="~{includes/admin/topbar}" />

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <h1 class="h3 mb-2 text-gray-800">FAQ 목록</h1>
                <p class="mb-4">전체 목록 조회입니다.</p>

                <div class="mb-4">
                    <div class="form-group row">
                        <input type="hidden" id="input_faq_keyword_changed" value=""/>

                        <label class="col-sm-2 col-form-label">삭제여부</label>
                        <div class="col-sm-4">
                            <select class="select_search_faq_keyword form-control mb-2" name="deleted" id="search_faq_deleted" onchange="listener_faq_keyword_changed()">
                                <option value="" selected="selected">전체</option>
                                <option value="false">일반</option>
                                <option value="true">삭제</option>
                            </select>
                        </div>
                        <label class="col-sm-6 col-form-label"></label>

                        <label class="col-sm-2 col-form-label">등록 시기</label>
                        <div class="col-sm-3">
                            <input class="form-control mb-2" id="search_faq_sdate" type="date" onchange="listener_faq_keyword_changed()"/>
                        </div>
                        <div class="col-sm-3">
                            <input class="form-control mb-2" id="search_faq_fdate" type="date" onchange="listener_faq_keyword_changed()"/>
                        </div>
                        <div class="col-sm-4">
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('null', 'faq', listener_faq_keyword_changed); return false;">초기화</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('today', 'faq', listener_faq_keyword_changed); return false;">오늘</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('week', 'faq', listener_faq_keyword_changed); return false;">1주</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('month', 'faq', listener_faq_keyword_changed); return false;">1개월</button>
                        </div>

                        <label class="col-sm-2 col-form-label">키워드</label>
                        <div class="col-sm-4">
                            <select class="form-control mb-2" id="search_faq_keyword" onchange="set_search_keyword('faq')">
                                <option value="10" selected="selected">이름</option>
                            </select>
                        </div>
                        <div class="col-sm-6">
                            <input id="search_faq_title" onchange="listener_faq_keyword_changed();"
                                   class="form-control search_faq_keyword_each search_faq_keyword_each_10 mb-2" type="text" placeholder="내용을 입력하세요"/>
                        </div>
                    </div>
                </div>

                <div class="w-100">
                    <button class="btn btn-primary mb-2" onclick="location.href='/faq/admin_create'; return false;">생성하기</button>
                </div>
                <!-- DataTales Example -->
                <div class="table-responsive">
                    <table class="table table-bordered bg-white" id="dataTable">
                        <thead>
                        <tr>
                            <th>
                                <input class="input_chk_delete_faq_all" type="checkbox" keyword="all" id="input_chk_delete_faq_all" onclick="listener_chk_delete(this, 'faq')" />
                            </th>
                            <th>#</th>
                            <th>-</th>
                            <th>삭제여부</th>
                            <th>제목</th>
                            <th>입력일시/수정일시</th>
                        </tr>
                        </thead>
                        <tbody id="tbody_faq_list">
                        </tbody>
                    </table>
                    <div class="w-100 m-auto">
                        <button class="btn btn-danger" onclick="delete_faq(); return false;">삭제</button>
                    </div>
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <th:block th:replace="~{includes/admin/footer}" />

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<th:block th:replace="~{includes/admin/bottom}" />

<script>
    $( document ).ready(function() {
        console.log( "ready!" );
        search_faq();
    });
</script>

<script>
    function listener_faq_keyword_changed(){
        $("#input_faq_keyword_changed").val("1");
        search_faq();
    }
    function search_faq() {
        let _data = new Map();
        _data.url = "/api/faq/list";
        _data.type = "GET";
        _data.param = {
            sdate: $("#search_faq_sdate").val()
            , fdate: $("#search_faq_fdate").val()

            , deleted: listenerGetBooleanFromSelect("search_faq_deleted")
            , title: $("#search_faq_title").val()
        };
        _data.success = function (obj_data, obj_status, obj_xhr) {
            let input_faq_keyword_changed = $("#input_faq_keyword_changed").val();
            if(input_faq_keyword_changed === "1"){
                $("#input_faq_keyword_changed").val("");
            }
            $("#tbody_faq_list").html("");
            let tempList = obj_data;
            for (let each of tempList) {
                let tList = [];
                tList.push(each);
                $("#tbody_faq_list").append(list_info_faq_template({"resultData_faq": tList}));
            }
            listenerAfterScrollList("faq");
        }
        _data.error = function (obj_data, obj_status, obj_xhr) {
            alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
        }
        func_ajax(_data);
    }

    function delete_faq() {
        if (confirm("정말 삭제하시겠습니까?")) {
        } else {
            alert("취소");
            return false;
        }
        let ids = listenerGetDeleteIds('faq');
        let _data = new Map();
        _data.url = "/api/faq/list";
        _data.type = "DELETE";
        _data.param = {
            'ids' : ids
        };
        _data.success = function(obj_data, obj_status, obj_xhr){
            search_faq();
        }
        _data.error = function(obj_data, obj_status, obj_xhr){
            alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
        }
        func_ajax(_data);
    }
    function update_faq_sequence(obj_id, obj_way){
        let _data = new Map();
        _data.url = "/api/faq/sequence";
        _data.type = "PUT";
        _data.param = {
            'id' : obj_id
            , 'way' : (obj_way === "up")
        };
        _data.success = function(obj_data, obj_status, obj_xhr){
            //alert(JSON.stringify(obj_data));
            if(obj_data["result"]){
                search_faq();
            } else {
                alert("이동이 불가합니다.");
            }
        }
        _data.error = function(obj_data, obj_status, obj_xhr){
            alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
        }
        func_ajax(_data);
    }
</script>

</body>

</html>