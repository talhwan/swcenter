<!DOCTYPE html>
<html lang="en">

<th:block th:replace="~{includes/admin/head}" />

<script id="list_info_notice" type="text/x-handlebars-template">
    {{#resultData_notice}}
    <tr class="gradeA">
        <td>
            <input class="input_chk_delete_notice_each" type="checkbox" keyword="{{id}}" id="input_chk_delete_notice_each_{{id}}" onclick="listener_chk_delete(this, 'notice')" />
        </td>
        <td><font class="font_notice_order"></font></td>
        <td><font class="font_notice_deleted_{{deleted}} chk_notice_deleted_{{id}}">{{deleted}}</font></td>
        <td class="cursor_pointer" onclick="location.href='/notice/admin_detail/{{id}}';">{{title}}</td>
        <td>{{createdAt}} / {{modifiedAt}}
            <div class="hide">
                <input class="input_cursor_notice_id" value="{{id}}"/>
            </div>
        </td>
    </tr>
    {{/resultData_notice}}
</script>
<script type="text/javascript">
    var list_info_notice = $("#list_info_notice").html();
    var list_info_notice_template = Handlebars.compile(list_info_notice);
</script>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <th:block th:replace="~{includes/admin/sidebar}" />
    <script>
        $(".nav_notice_a").removeClass("collapsed");
        $(".nav_notice_div").addClass("show");
    </script>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <th:block th:replace="~{includes/admin/topbar}" />

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <h1 class="h3 mb-2 text-gray-800">공지사항 목록</h1>
                <p class="mb-4">전체 목록 조회입니다.</p>

                <div class="mb-4">
                    <div class="form-group row">
                        <input type="hidden" id="input_notice_keyword_changed" value=""/>

                        <label class="col-sm-2 col-form-label">삭제여부</label>
                        <div class="col-sm-4">
                            <select class="select_search_notice_keyword form-control mb-2" name="deleted" id="search_notice_deleted" onchange="listener_notice_keyword_changed()">
                                <option value="" selected="selected">전체</option>
                                <option value="false">일반</option>
                                <option value="true">삭제</option>
                            </select>
                        </div>
                        <label class="col-sm-6 col-form-label"></label>

                        <label class="col-sm-2 col-form-label">등록 시기</label>
                        <div class="col-sm-3">
                            <input class="form-control mb-2" id="search_notice_sdate" type="date" onchange="listener_notice_keyword_changed()"/>
                        </div>
                        <div class="col-sm-3">
                            <input class="form-control mb-2" id="search_notice_fdate" type="date" onchange="listener_notice_keyword_changed()"/>
                        </div>
                        <div class="col-sm-4">
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('null', 'notice', listener_notice_keyword_changed); return false;">초기화</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('today', 'notice', listener_notice_keyword_changed); return false;">오늘</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('week', 'notice', listener_notice_keyword_changed); return false;">1주</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('month', 'notice', listener_notice_keyword_changed); return false;">1개월</button>
                        </div>

                        <label class="col-sm-2 col-form-label">키워드</label>
                        <div class="col-sm-4">
                            <select class="form-control mb-2" id="search_notice_keyword" onchange="set_search_keyword('notice')">
                                <option value="10" selected="selected">이름</option>
                            </select>
                        </div>
                        <div class="col-sm-6">
                            <input id="search_notice_title" onchange="listener_notice_keyword_changed();"
                                   class="form-control search_notice_keyword_each search_notice_keyword_each_10 mb-2" type="text" placeholder="내용을 입력하세요"/>
                        </div>

                        <input type="hidden" id="cursor_notice" />
                        <label class="col-sm-2 col-form-label">검색 기준</label>
                        <div class="col-sm-2">
                            <select class="form-control" id="search_notice_orderby" onchange="listener_notice_keyword_changed();">
                                <option value="id" selected="selected">등록순</option>
                                <option value="title">제목순</option>
                            </select>
                        </div>
                        <label class="col-sm-2 col-form-label">한번에 불러올 갯수</label>
                        <div class="col-sm-2">
                            <select class="form-control" id="search_notice_perpage" onchange="listener_notice_keyword_changed();">
                                <option value="10" selected="selected">10</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        <label class="col-sm-2 col-form-label">조회방향</label>
                        <div class="col-sm-2">
                            <select class="form-control" id="search_notice_orderway" onchange="listener_notice_keyword_changed();">
                                <option value="DESC" selected="selected">역방향</option>
                                <option value="ASC">정방향</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="w-100">
                    <button class="btn btn-primary mb-2" onclick="location.href='/notice/admin_create'; return false;">생성하기</button>
                </div>
                <!-- DataTales Example -->
                <div class="table-responsive">
                    <table class="table table-bordered bg-white" id="dataTable">
                        <thead>
                        <tr>
                            <th>
                                <input class="input_chk_delete_notice_all" type="checkbox" keyword="all" id="input_chk_delete_notice_all" onclick="listener_chk_delete(this, 'notice')" />
                            </th>
                            <th>#</th>
                            <th>삭제여부</th>
                            <th>제목</th>
                            <th>입력일시/수정일시</th>
                        </tr>
                        </thead>
                        <tbody id="tbody_notice_list">
                        </tbody>
                    </table>
                    <div class="w-100 m-auto">
                        <button class="btn btn-danger" onclick="delete_notice(); return false;">삭제</button>
                        <button class="btn btn-primary" onclick="search_notice(); return false;">더보기</button>
                    </div>
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <th:block th:replace="~{includes/admin/footer}" />

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<th:block th:replace="~{includes/admin/bottom}" />

<script>
    $( document ).ready(function() {
        console.log( "ready!" );
        search_notice();
    });
</script>

<script>
    function listener_notice_keyword_changed(){
        $("#input_notice_keyword_changed").val("1");
        $("#tbody_notice_list").html("");
        search_notice();
    }
    function search_notice() {
        let _data = new Map();
        _data.url = "/api/notice/scrollList";
        _data.type = "GET";
        _data.param = {
            perpage: $("#search_notice_perpage").val()
            , orderby: $("#search_notice_orderby").val()
            , orderway: $("#search_notice_orderway").val()
            , cursor: listenerGetCursor("notice")

            , sdate: $("#search_notice_sdate").val()
            , fdate: $("#search_notice_fdate").val()

            , deleted: listenerGetBooleanFromSelect("search_notice_deleted")
            , title: $("#search_notice_title").val()
        };
        _data.success = function (obj_data, obj_status, obj_xhr) {
            let input_notice_keyword_changed = $("#input_notice_keyword_changed").val();
            if(input_notice_keyword_changed === "1"){
                $("#input_notice_keyword_changed").val("");
            }

            let tempList = obj_data;
            for (let each of tempList) {
                let tList = [];
                tList.push(each);
                $("#tbody_notice_list").append(list_info_notice_template({"resultData_notice": tList}));
            }
            listenerAfterScrollList("notice");
        }
        _data.error = function (obj_data, obj_status, obj_xhr) {
            alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
        }
        func_ajax(_data);
    }

    function delete_notice() {
        if (confirm("정말 삭제하시겠습니까?")) {
        } else {
            alert("취소");
            return false;
        }
        let ids = listenerGetDeleteIds('notice');
        let _data = new Map();
        _data.url = "/api/notice/list";
        _data.type = "DELETE";
        _data.param = {
            'ids' : ids
        };
        _data.success = function(obj_data, obj_status, obj_xhr){
            search_notice();
        }
        _data.error = function(obj_data, obj_status, obj_xhr){
            alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
        }
        func_ajax(_data);
    }
</script>

</body>

</html>