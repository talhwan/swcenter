<!DOCTYPE html>
<html lang="ko">
<th:block th:replace="~{includes/user/head}" />
<link rel="stylesheet" href="/frontswcenter/css/aside.css">
<body>

<th:block th:replace="~{includes/user/header}" />

<div class="page-layout">
    <th:block th:replace="~{includes/user/aside}" />
    <script> listener_aside_nav_active("news", 1); </script>

    <main class="content-area">
        <h1 class="page-title">공지사항 작성</h1>

        <div class="content-box">
            <div class="form-grid">
                <div class="form-field">
                    <label for="create_notice_title">제목</label>
                    <input type="text" class="input_param input_required" id="create_notice_title" name="title" placeholder="제목을 입력해주세요." />
                </div>
                <div class="form-field">
                    <label for="create_notice_content">내용</label>
                    <textarea class="input_param" id="create_notice_content" name="content" placeholder="내용을 입력해주세요."></textarea>
                </div>
                <div class="form-field">
                    <label for="create_notice_img">메인 이미지</label>
                    <input type="file" id="create_notice_img" accept="image/*" onchange="listenerSetImage(this, null)" />
                    <img class="hide" id="img_create_notice_img" style="height: 75px;" alt="메인 사진" />
                </div>
                <div class="content-actions">
                    <button class="primary-button" onclick="create_notice(); return false;">등록하기</button>
                </div>
            </div>
        </div>
    </main>
</div>

<th:block th:replace="~{includes/user/footer}" />
<th:block th:replace="~{includes/user/bottom}" />

<script>
    $(function(){
        if (!listener_is_login()) {
            alert("로그인이 필요합니다.");
            location.replace("/user/login");
        }
    });
    function create_notice(){
        let _param = listenerCreateParam();
        let tempFile = null;
        let inputFile = document.getElementById('create_notice_img');
        if (inputFile.files.length > 0) {
            tempFile = inputFile.files[0];
        }
        let formData = new FormData();
        formData.append('file', tempFile);
        formData.append('params', new Blob([JSON.stringify(_param)], {
            type: "application/json; charset=utf-8"
        }));
        let _data = {
            url: "/api/notice",
            type: "POST",
            param: formData,
            contentType: false,
            success: function(){
                alert("등록 성공");
                location.href = "/notice/list";
            },
            error: function(){
                alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
            }
        };
        func_ajax(_data);
    }
</script>
</body>
</html>
