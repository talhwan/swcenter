<!DOCTYPE html>
<html lang="ko">
<th:block th:replace="~{includes/user/head}" />
<link rel="stylesheet" href="/frontswcenter/css/aside.css">
<body>

<th:block th:replace="~{includes/user/header}" />

<div class="page-layout">
    <th:block th:replace="~{includes/user/aside}" />
    <script> listener_aside_nav_active("board", 1); </script>

    <main class="content-area detail-page">
        <h1 class="page-title">일반게시판</h1>

        <div class="content-box detail-card">
            <div class="detail-title font_board_title">-</div>
            <div class="detail-meta">
                <span class="font_board_createdAt">-</span>
                <span class="detail-divider"></span>
                <span>조회수 <span id="board_view_count">0</span></span>
                <span class="detail-divider"></span>
                <span>좋아요 <span id="board_like_count">0</span></span>
                <div class="detail-actions">
                    <button class="ghost-button" id="board_like_btn" onclick="toggle_board_like(); return false;">좋아요</button>
                    <button class="ghost-button" id="board_report_btn" onclick="report_board(); return false;">신고하기</button>
                </div>
            </div>
            <div class="detail-body font_board_content">-</div>

            <div class="comment-box">
                <div class="comment-header">
                    <h3>댓글</h3>
                </div>
                <div id="board_comment_list"></div>
                <div class="comment-input-row">
                    <textarea class="input_param" id="board_comment_input" name="comment" placeholder="댓글을 입력해주세요."></textarea>
                    <button class="primary-button" onclick="add_board_comment(); return false;">댓글 등록</button>
                </div>
            </div>
            <div class="detail-footer">
                <button class="secondary-button" onclick="location.href='/board/list'; return false;">목록으로</button>
            </div>
        </div>

    </main>

</div>

<th:block th:replace="~{includes/user/footer}" />
<th:block th:replace="~{includes/user/bottom}" />

<script>
    let currentBoardId = null;
    let currentBoardViewCount = null;

    function render_board_extras(data) {
        let likeCount = parseInt(data.likeCount, 10);
        let viewCount = parseInt(data.viewCount, 10);
        $("#board_view_count").text(Number.isFinite(viewCount) ? viewCount : 0);
        $("#board_like_count").text(Number.isFinite(likeCount) ? likeCount : 0);
        $("#board_like_btn").text("좋아요");
        $("#board_report_btn").prop("disabled", false).text("신고하기");
    }
    function toggle_board_like() {
        if (!currentBoardId) { return; }
        alert("좋아요 버튼 클릭");
    }
    function report_board() {
        if (!currentBoardId) { return; }
        alert("신고 처리 버튼 클릭");
    }
    function get_board_comments(id) {
        return [];
    }
    function render_board_comments(id) {
        let list = get_board_comments(id);
        let $list = $("#board_comment_list");
        $list.html("");
        if (list.length === 0) {
            $list.append("<div class=\"comment-empty\">등록된 댓글이 없습니다.</div>");
            return;
        }
        for (let item of list) {
            let $item = $("<div class=\"comment-item\"></div>");
            $("<div class=\"comment-text\"></div>").text(item.text).appendTo($item);
            $("<div class=\"comment-meta\"></div>").text(item.createdAt).appendTo($item);
            $list.append($item);
        }
    }
    function add_board_comment() {
        if (!currentBoardId) { return; }
        let text = $("#board_comment_input").val().trim();
        if (!text) {
            alert("댓글 내용을 입력해주세요.");
            return;
        }
        alert("댓글 등록 버튼 클릭");
    }

    $(function(){
        console.log( "ready!" );
        detail_board();
    });
    function detail_board() {
        let boardId = getIdFromUrl(null);
        let _data = new Map();
        _data.url = "/api/board";
        _data.type = "GET";
        _data.param = {'id': boardId};
        _data.success = function (obj_data, obj_status, obj_xhr) {
            listenerAfterDetail(obj_data, "board");
            currentBoardId = boardId;
            currentBoardViewCount = parseInt(obj_data.countread, 10);
            if (!Number.isFinite(currentBoardViewCount)) {
                currentBoardViewCount = null;
            }
            render_board_extras(obj_data || {});
            render_board_comments(boardId);
        }
        _data.error = function (obj_data, obj_status, obj_xhr) {
            alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
        }
        func_ajax(_data);
    }
</script>
</body>

</html>
